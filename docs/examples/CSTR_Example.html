

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CSTR Reactor &mdash; HILO-MPC 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="HILO-MPC 1.0 documentation" href="../index.html"/>
        <link rel="next" title="Learning an MPC controller with a NN" href="learn_mpc.html"/>
        <link rel="prev" title="Path following vs Trajectory Tracking MPC" href="path_following_mpc.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> HILO-MPC
          

          
            
            <img src="../_static/hilo_logo_short_2.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption" role="heading"><span class="caption-text">Quick start:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citing HILO-MPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nmpc_hybrid_bio.html">Learning Supported MPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="mhe_chemical_reaction.html">Moving Horizon Estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpc_formula1.html">Formula 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpc_pendulum.html">Inverted pendulum - DAE System</a></li>
<li class="toctree-l1"><a class="reference internal" href="path_following_mpc.html">Path following vs Trajectory Tracking MPC</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CSTR Reactor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Process-Model">Process Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Parameter,-steady-state,-and-limit-values">Parameter, steady-state, and limit values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Model-Builder">Model Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Neural-Network">Neural Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Training-Data-Generation">Training Data Generation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Neural-Network-Parameters">Neural Network Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#MPC">MPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plant-MPC-Comparison">Plant MPC Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#MPC-Performance-Comparison">MPC Performance Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Acknowledgement">Acknowledgement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="learn_mpc.html">Learning an MPC controller with a NN</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/controllers.html">Control module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/machinelearnings.html">Machine learning module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/modellings.html">Modelling module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/estimators.html">Observer module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modelling.html">Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/estimators.html">Observers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HILO-MPC</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>CSTR Reactor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/CSTR_Example.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="CSTR-Reactor">
<h1>CSTR Reactor<a class="headerlink" href="#CSTR-Reactor" title="Permalink to this headline">¶</a></h1>
<p>This example follows the example shown in <a class="reference external" href="https://www.mdpi.com/2227-7390/7/10/890">Zhang et al. (2019)</a> where a continuous stirred tank reactor (CSTR) with a reversible exothermic reaction <span class="math notranslate nohighlight">\(A\leftrightarrow B\)</span> is used to show how neural networks can be used with model predictive control to control and optimise a chemical process.</p>
<p><img alt="a39417dc25e1436aa0e9393cf9d685df" class="no-scaled-link" src="../_images/CSTR_Example_image.png" style="width: 800px;" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Add HILO-MPC to path. NOT NECESSARY if it was installed via pip.
import sys
sys.path.append(&#39;../../../&#39;)

##### Import Libraries #####
import pandas as pd
import numpy as np
import math
import casadi as ca
import matplotlib.pyplot as plt
from hilo_mpc import Model
from hilo_mpc import ANN, Layer
from hilo_mpc import NMPC

# Ignore deprecation warnings coming from tensorflow
import warnings
warnings.filterwarnings(&quot;ignore&quot;)
</pre></div>
</div>
</div>
<section id="Process-Model">
<h2>Process Model<a class="headerlink" href="#Process-Model" title="Permalink to this headline">¶</a></h2>
<p>The dynamic equations for the concentration of component A and B is obtained from the mass balance. The <a class="reference external" href="https://en.wikipedia.org/wiki/Arrhenius_equation">Arrhenius rate equation</a>, <span class="math notranslate nohighlight">\(k=Ae^{\frac{-E_{a}}{RT}}\)</span>, is used as the reaction rate expression due to its <a class="reference external" href="https://en.wikipedia.org/wiki/Reaction_rate">dependency on temperature</a>. The reactor temperature is described from the energy balance where the CSTR is modelled with a cooling jacket with duty Q.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
    \frac{dC_{A}}{dt} &amp;=  \frac{1}{\tau} \left(C_{A_{0}}-C_{A}\right) - r \label{eq1}\tag{1} \\
    \frac{dC_{B}}{dt} &amp;= -\frac{1}{\tau}C_{B} + r \label{eq2}\tag{2} \\
    \frac{T}{dt} &amp;= -\frac{\Delta H r}{\rho C_{P}} + \frac{1}{\tau} \left(T_{0}-T\right) + \frac{Q}{\rho C_{P} V} \label{eq3}\tag{3} \\
    r &amp;=  k_{A}e^{\frac{-E_{A}}{RT}}C_{A} - k_{B}e^{\frac{-E_{B}}{RT}}C_{B} \label{eq4}\tag{4}
\end{align}\end{split}\]</div>
<p>### Notes and assumptions</p>
<ul class="simple">
<li><p>It is assumed that both species have identical heat capacities and densities, thus the heat capacity and density of the mixture is assumed to be independent of the concentration of the different species.</p></li>
<li><p>The density is assumed to be independent of temperature.</p></li>
<li><p>The reactor is assumed to operate isobarically and adiabatically.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(C_{A_{0}}\)</span> is constant, then <a class="reference external" href="#mjx-eqn-eq2">equation 2</a> is not necessary and <span class="math notranslate nohighlight">\(C_{B}=C_{A_{0}}-C_{A}\)</span>. In this example <span class="math notranslate nohighlight">\(C_{A_{0}}\)</span> is constant but the full implementation is shown.</p></li>
<li><p>A low reactor temperature will result in a slow forward reaction rate and subsequently a low conversion of A. A high reactor temperature will favour the reversible reaction and will result in a lower conversion of A. The optimal conversion of A is achieved at 438.47K.</p></li>
</ul>
<p><img alt="b5a7698b29b14259b08c9c25146cc564" src="../_images/CSTR_Example_Reaction_Rate.png" /></p>
<section id="Parameter,-steady-state,-and-limit-values">
<h3>Parameter, steady-state, and limit values<a class="headerlink" href="#Parameter,-steady-state,-and-limit-values" title="Permalink to this headline">¶</a></h3>
<table><tr><td><table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 18%" />
<col style="width: 23%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Variable</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Initial Temperature</p></td>
<td><p><span class="math notranslate nohighlight">\(T_{0}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(400\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Residence Time</p></td>
<td><p><span class="math notranslate nohighlight">\(\tau\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(60\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(s\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Reaction Rate Constant for A</p></td>
<td><p><span class="math notranslate nohighlight">\(k_{A}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5000\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{s}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Reaction Rate Constant for B</p></td>
<td><p><span class="math notranslate nohighlight">\(k_{B}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\times10^{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{s}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Activation Energy for A</p></td>
<td><p><span class="math notranslate nohighlight">\(E_{A}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\times10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{mol}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Activation Energy for B</p></td>
<td><p><span class="math notranslate nohighlight">\(E_{B}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.5\times10^{4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{mol}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Universal Gas Constant</p></td>
<td><p><span class="math notranslate nohighlight">\(R\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.987\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{mol K}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Heat of Reaction</p></td>
<td><p><span class="math notranslate nohighlight">\(\Delta H\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-5000\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{mol}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Density of the Mixture</p></td>
<td><p><span class="math notranslate nohighlight">\(\rho\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{kg}{L}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Heat Capacity of the Mixture</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{P}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1000\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{kg K}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Initial Concentration for A</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{A_{0}}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{mol}{L}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>CSTR Volume</p></td>
<td><p><span class="math notranslate nohighlight">\(V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(100\)</span></p></td>
<td><p>$L $</p></td>
</tr>
<tr class="row-even"><td><p>Steady-state Concentration for A</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{A_{SS}}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.4912\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{mol}{L}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Steady-state Concentration for B</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{B_{SS}}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.5088\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{mol}{L}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Steady-state CSTR Temperature</p></td>
<td><p><span class="math notranslate nohighlight">\(T_{SS}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(438.47\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Steady-state Cooling Jacket Duty</p></td>
<td><p><span class="math notranslate nohighlight">\(Q_{SS}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(59881.84\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{s}\)</span></p></td>
</tr>
</tbody>
</table>
</td></tr></table><center><p>Table 1: The parameters and steady-state values from [Zhang et al. (2019)]</p>
</center><table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 18%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Variable</p></th>
<th class="head"><p>Lower Limit</p></th>
<th class="head"><p>Upper Limit</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Concentration for A</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{A}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{mol}{L}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Concentration for B</p></td>
<td><p><span class="math notranslate nohighlight">\(C_{B}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{mol}{L}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Temperature</p></td>
<td><p><span class="math notranslate nohighlight">\(T\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(400\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(500\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Cooling Jacket Duty</p></td>
<td><p><span class="math notranslate nohighlight">\(Q\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(10^{5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{cal}{s}\)</span></p></td>
</tr>
</tbody>
</table>
<center><p>Table 2: State and input limits from [Zhang et al. (2019)]</p>
</center><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### Parameter, Steady-state, and Limit Values #####
# Parameter values
T_0 = 400
tau = 60
k_A = 5000
k_B = 1e6
E_A = 1e4
E_B = 1.5e4
R = 1.987
dH = -5000
rho = 1
Cp = 1000
C_A_0 = 1
V = 100
C_B_0 = 0 # Initial concentration for B is 0

# Steady-state values
C_A_SS = 0.4912
C_B_SS = 0.5088
T_SS = 438.47
Q_SS = 59881.84

# States and input limits
C_A_ll = 0.
C_A_ul = 1.
C_B_ll = 0.
C_B_ul = 1.
T_ll = 400.
T_ul = 500.
Q_ll = 0.
Q_ul = 1e5

# ANN training data limits
C_A_ll_nn = 0.
C_A_ul_nn = 1.
C_B_ll_nn = 0.
C_B_ul_nn = 1.
T_ll_nn = 400.
T_ul_nn = 500.
</pre></div>
</div>
</div>
</section>
</section>
<section id="Model-Builder">
<h2>Model Builder<a class="headerlink" href="#Model-Builder" title="Permalink to this headline">¶</a></h2>
<p>The states are the concentration of species A, <span class="math notranslate nohighlight">\(C_{A}\)</span>, and B, <span class="math notranslate nohighlight">\(C_{B}\)</span>, as well as the reactor temperature, <span class="math notranslate nohighlight">\(T\)</span>. The heat rate of the cooling jacking is the only one input, <span class="math notranslate nohighlight">\(Q\)</span>.</p>
<p>The true plant model is used to compare against the hybrid model. Both the plant and hybrid model is defined similar with only the reaction rate defined as a parameter in the hybrid model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### Model Builder #####
def true_plant_model():
    true_plant_model = Model(plot_backend=&#39;bokeh&#39;, name=&#39;plant&#39;)
    x = true_plant_model.set_dynamical_states([&#39;C_A&#39;, &#39;C_B&#39;, &#39;T&#39;])
    u = true_plant_model.set_inputs([&#39;Q&#39;])

    # Unwrap states
    C_A = x[0]
    C_B = x[1]
    T = x[2]

    # Unwrap inputs
    Q = u[0]

    # Unknown reaction rates
    r = k_A * ca.exp((-E_A)/(R * T)) * C_A - k_B * ca.exp((-E_B)/(R * T)) * C_B

    dC_A = 1/tau * (C_A_0 - C_A) - r
    dC_B = -1/tau * C_B + r
    dT = - (dH * r)/(rho * Cp) + 1/tau * (T_0 - T) + Q / (rho * Cp * V)

    true_plant_model.set_dynamical_equations([dC_A, dC_B, dT])
    true_plant_model.set_measurement_equations([r])

    return true_plant_model

def hybrid_model():
    hybrid_model = Model(plot_backend=&#39;bokeh&#39;, name=&#39;model&#39;)
    x = hybrid_model.set_dynamical_states([&#39;C_A&#39;, &#39;C_B&#39;, &#39;T&#39;])
    u = hybrid_model.set_inputs([&#39;Q&#39;])
    p = hybrid_model.set_parameters([&#39;r&#39;])

    # Unwrap states
    C_A = x[0]
    C_B = x[1]
    T = x[2]

    # Unwrap inputs
    Q = u[0]

    # Unknown reaction rates
    r = p[0]

    dC_A = 1/tau * (C_A_0 - C_A) - r
    dC_B = -1/tau * C_B + r
    dT = - (dH * r)/(rho * Cp) + 1/tau*(T_0 - T) + Q / (rho * Cp * V)

    hybrid_model.set_dynamical_equations([dC_A, dC_B, dT])
    hybrid_model.set_measurement_equations([r])

    return hybrid_model
</pre></div>
</div>
</div>
</section>
<section id="Neural-Network">
<h2>Neural Network<a class="headerlink" href="#Neural-Network" title="Permalink to this headline">¶</a></h2>
<p>The reaction rate expression (<a class="reference external" href="#mjx-eqn-eq4">equation 4</a>) is difficult to obtain in practice. Some reactions have complex reaction mechanisms resulting in a very complex rate expression. Obtaining kinetic parameters are also difficult and costly. Machine learning techniques can be used to obtain a reaction rate approximation using experimental/plant data.</p>
<section id="Training-Data-Generation">
<h3>Training Data Generation<a class="headerlink" href="#Training-Data-Generation" title="Permalink to this headline">¶</a></h3>
<p>The assumed reaction rate expression and parameters for this example is used to create data to illustrate how a neural network can be used to model the reaction rate from data. <a class="reference external" href="https://www.mdpi.com/2227-7390/7/10/890">Zhang et al. (2019)</a> generated eight million data points (200 data points per feature) by varying the reactor temperature and concentrations of both components equidistantly. In this example only 20 data points per feature is used to get to a total of 800 data points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### Training Data Generation #####
training_data_array = []
data_points_per_feature = 20 # The size of the training data set will be data_points_per_feature^[number of features=3]

# Create ranges for the state variables

T_range = np.arange(T_ll_nn, T_ul_nn + (T_ul_nn - T_ll_nn)
                    / data_points_per_feature, (T_ul_nn - T_ll_nn) / (data_points_per_feature - 1))

C_A_range = np.arange(C_A_ll_nn, C_A_ul_nn + (C_A_ul_nn - C_A_ll_nn)
                      / data_points_per_feature, (C_A_ul_nn - C_A_ll_nn) / (data_points_per_feature - 1))

C_B_range = np.arange(C_B_ll_nn, C_B_ul_nn + (C_B_ul_nn - C_B_ll_nn)
                      / data_points_per_feature, (C_B_ul_nn - C_B_ll_nn) / (data_points_per_feature - 1))

# Calculate the reaction rate at each combination
for T in T_range:
    for C_A in C_A_range:
        for C_B in C_B_range:
            r = k_A * math.exp((-E_A) / (R * T)) * C_A - k_B * math.exp((-E_B) / (R * T)) * C_B
            training_data_array.append([C_A, C_B, T, r])

df = pd.DataFrame(training_data_array, columns = [&quot;C_A&quot;, &quot;C_B&quot;, &quot;T&quot;, &quot;r&quot;])
</pre></div>
</div>
</div>
</section>
</section>
<section id="Neural-Network-Parameters">
<h2>Neural Network Parameters<a class="headerlink" href="#Neural-Network-Parameters" title="Permalink to this headline">¶</a></h2>
<p>The neural network parameters are summarised in Table 3.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 35%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Article</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Platform</p></td>
<td><p>Matlab Neural Network Toolbox</p></td>
<td><p>Python MPC Toolbox</p></td>
</tr>
<tr class="row-odd"><td><p>Training Algorithm / Optimiser</p></td>
<td><p>Levenberg-Marquardt</p></td>
<td><p>Adam Optimiser</p></td>
</tr>
<tr class="row-even"><td><p>Loss Function</p></td>
<td><p>Mean Square Error</p></td>
<td><p>Mean Square Error</p></td>
</tr>
<tr class="row-odd"><td><p>Hidden Layers</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>Hidden Neurons</p></td>
<td><p>10</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>Activation Function</p></td>
<td><p>tanh</p></td>
<td><p>tanh</p></td>
</tr>
<tr class="row-even"><td><p>Batch Size</p></td>
<td><p>n/a</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>Maximum Number of Epochs</p></td>
<td><p>n/a</p></td>
<td><p>500</p></td>
</tr>
<tr class="row-even"><td><p>Validation Data Split</p></td>
<td><p>n/a</p></td>
<td><p>20%</p></td>
</tr>
<tr class="row-odd"><td><p>Training Data Split</p></td>
<td><p>n/a</p></td>
<td><p>20%</p></td>
</tr>
<tr class="row-even"><td><p>Validation Stopping Criteria</p></td>
<td><p>n/a</p></td>
<td><p>No change in 100 Epochs</p></td>
</tr>
</tbody>
</table>
<center><p>Table 3: Neural network parameters</p>
</center><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### Neural Network #####
# Hyperparameters
    # Setup
learning_rate = 0.001
optimizer = &#39;Adam&#39;
loss = &#39;mse&#39;
backend = &#39;pytorch&#39;
number_of_hidden_neurons = 10
activation_function = &#39;tanh&#39;                   # See https://pytorch.org/docs/stable/nn.init.html for different activation functions
seed = &#39;42&#39;
device = &#39;cpu&#39;
    # Training
batch_size = 100
epochs = 500
verbose = 0
validation_split = 0.2
test_split = 0.2
patience = 100

# Neural network features and labels
features = [&#39;C_A&#39;, &#39;C_B&#39;, &#39;T&#39;]                 # States of the model
labels = [&#39;r&#39;]                                 # Unknown parameter

# Create and train neural network
ann = ANN(features,
          labels,
          learning_rate = learning_rate,       # Default=0.001
          optimizer = optimizer,               # Default=Adam
          loss = loss,                         # Default=mse
          backend = backend)                   # Default=pytorch

# Add hidden layers to the nerual network
ann.add_layers(Layer.dense(number_of_hidden_neurons, activation = activation_function)) # Dense in Keras is similar to Linear in PyTorch

# Setup nerual network
ann.setup(seed = seed,                         # Default=42
          save_tensorboard = True,             # Default=False
          tensorboard_log_dir = &#39;./NN&#39;,        # Folder where ANN tensorboard model will be saved
          device = device)                     # CUDA is used if available. Device can also be set if required

# Add the dataset to the trainer
    # Data is Z-score/Standard score normalised (mean of the data is shifted to zero and standard deviation of 1 is created)
    # Output is scaled back
ann.add_data_set(df)

# Train nerual network
ann.train(batch_size = batch_size,             # Number of samples per gradient update.
          epochs = epochs,                     # Number of epochs to train the model.
          verbose = verbose,                   # Verbosity mode (0 = silent, 1 = progress bar, 2 = one line per epoch). Default=1
          validation_split = validation_split, # Fraction of the training data to be used as validation data. Default=0, range [0,1).
          test_split = test_split,             # Default=0, range [0,1)
          patience = patience,                 # Number of epochs with no improvement after which training will be stopped. Default=None, np.split()
          scaler = None,                       # Default=None (StandardScaler)
          scale_data = True,                   # Default=None
          scaler_backend = &#39;sklearn&#39;,          # Optional, Default=None
          shuffle = True)                      # Default=True, uses numpy.random.shuffle()

# To see the tensorboard results
# ann.show_tensorboard()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Evaluate on test data
</pre></div></div>
</div>
</section>
<section id="MPC">
<h2>MPC<a class="headerlink" href="#MPC" title="Permalink to this headline">¶</a></h2>
<p>An economic model predictive controller (MPC) is used to control the plant at the set points. The set points for the plant is calculated by the economic MPC. The article uses a real-time optimisation (RTO) strategy with a Lyapunov-based MPC (LMPC). Table 4 summarises the MPC parameters.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 25%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Description</p></th>
<th class="head"><p>Units</p></th>
<th class="head"><p>Article</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Sampling Period</p></td>
<td><p><span class="math notranslate nohighlight">\(s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Heating Price</p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{s}{cal}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(7 \times10^{-7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(7 \times10^{-7}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Prediction Horizon</p></td>
<td><p><span class="math notranslate nohighlight">\(s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(10\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(10\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Modelling Period</p></td>
<td><p><span class="math notranslate nohighlight">\(s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1000\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1000\)</span></p></td>
</tr>
</tbody>
</table>
<center><p>Table 4: MPC parameters</p>
</center><p>Scaling values where also chosen to ensure that all the state and input values are of the same oder. The temperature of the reactor is scaled by 100 while the heat duty input was scaled by 100 000.</p>
<p>## Hybrid MPC Model Setup The reaction rate is substituted by the ANN model. The reactor is assumed to be initially at steady-state. The basic economic MPC cost function is given by <a class="reference external" href="https://link.springer.com/chapter/10.1007%2F978-3-319-77489-3_8">Matschek et al. (2019)</a> as:</p>
<div class="math notranslate nohighlight">
\[J_{economic}(x(t_{k}),\bar{u}_k(\cdot)) = \int_{t_{k}}^{t_{k}+T}L_{economic}(\bar{x}(\tau),\bar{u}_{k}(\tau))\:d \tau + E_{economical}(\bar{x}(t_{k}+T))\]</div>
<p>No terminal cost is assumed, thus <span class="math notranslate nohighlight">\(E_{economic}=0\)</span>. The stage cost is calculated by:</p>
<div class="math notranslate nohighlight">
\[L_{economic}(\bar{x}(\tau),\bar{u}_{k}(\tau))=\frac{C_{A}(\tau)}{C_{A_{0}}}+heat\:price \times Q(\tau)\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### Hybrid Model MPC Setup #####
# MPC Parameters
sampling_period = 1               # unit of time (dependent on the time units used in the modelling equations)
heat_price = 7e-7
modelling_period = 1000
prediction_horizon = 10
n_steps = int(modelling_period / sampling_period)
x_scaling_value = [1, 1, 1e2]
u_scaling_value = 1e5

# Plant Setup
plant = true_plant_model()
plant.setup(dt = sampling_period)
x0_plant = [C_A_0, C_B_0, T_0]
plant.set_initial_conditions(x0_plant)

# Model Setup
model = hybrid_model()
model.substitute_from(ann) # Substite the labels in the model with the ANN model
model.setup(dt = sampling_period)

# NMPC Hybrid Model Setup
nmpc_hybrid_model = NMPC(model)
nmpc_hybrid_model.set_scaling(x_scaling = x_scaling_value, u_scaling = u_scaling_value)
nmpc_hybrid_model.stage_cost.cost = model.x[0] / C_A_0 + model.u[0] * heat_price
nmpc_hybrid_model.horizon = prediction_horizon
nmpc_hybrid_model.set_box_constraints(x_lb = [C_A_ll, C_B_ll, T_ll], x_ub = [C_A_ul, C_B_ul, T_ul], u_lb = [Q_ll], u_ub = [Q_ul])
nmpc_hybrid_model.set_initial_guess(x_guess = [C_A_SS, C_B_SS, T_SS], u_guess = [Q_SS])
nmpc_hybrid_model.setup(options = {&#39;print_level&#39;:0})

# Solve NMPC
solution_hybrid = plant.solution
for step in range(n_steps):
    u = nmpc_hybrid_model.optimize(x0_plant)
    plant.simulate(u = u)
    x0_plant = solution_hybrid[&#39;xf&#39;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

</pre></div></div>
</div>
</section>
<section id="Plant-MPC-Comparison">
<h2>Plant MPC Comparison<a class="headerlink" href="#Plant-MPC-Comparison" title="Permalink to this headline">¶</a></h2>
<p>The true plant model is used to evaluate the performance of the hybrid MPC setup.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### True Plant Model MPC Setup #####
# Plant Setup
plant = true_plant_model()
plant.setup(dt = sampling_period)
x0_plant = [C_A_0, C_B_0, T_0]
plant.set_initial_conditions(x0_plant)

# NMPC Plant Model Setup
nmpc_plant = NMPC(plant)
nmpc_plant.set_scaling(x_scaling = x_scaling_value, u_scaling = u_scaling_value)
nmpc_plant.stage_cost.cost = plant.x[0] / C_A_0 + plant.u[0] * heat_price
nmpc_plant.horizon = prediction_horizon
nmpc_plant.set_box_constraints(x_lb = [C_A_ll, C_B_ll, T_ll], x_ub = [C_A_ul, C_B_ul, T_ul], u_lb = [Q_ll], u_ub = [Q_ul])
nmpc_plant.set_initial_guess(x_guess = [C_A_SS, C_B_SS, T_SS], u_guess = [Q_SS])
nmpc_plant.setup(options = {&#39;print_level&#39;:0})

# Solve NMPC
solution_true = plant.solution
for step in range(n_steps):
    u = nmpc_plant.optimize(x0_plant)
    plant.simulate(u = u)
    x0_plant = solution_true[&#39;xf&#39;]
</pre></div>
</div>
</div>
</section>
<section id="MPC-Performance-Comparison">
<h2>MPC Performance Comparison<a class="headerlink" href="#MPC-Performance-Comparison" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>##### MPC Performance Comparison #####
# Solution Values
    # Hybrid Model
Q_hybrid_values = np.array(solution_hybrid[&#39;Q&#39;]).squeeze()
Ca_hybrid_values = np.array(solution_hybrid[&#39;C_A&#39;]).squeeze()
Cb_hybrid_values = np.array(solution_hybrid[&#39;C_B&#39;]).squeeze()
T_hybrid_values = np.array(solution_hybrid[&#39;T&#39;]).squeeze()
converson_hybrid_values = (1 - Ca_hybrid_values / C_A_0) * 100
    # True Plant Model
Q_true_values = np.array(solution_true[&#39;Q&#39;]).squeeze()
Ca_true_values = np.array(solution_true[&#39;C_A&#39;]).squeeze()
Cb_true_values = np.array(solution_true[&#39;C_B&#39;]).squeeze()
T_true_values = np.array(solution_true[&#39;T&#39;]).squeeze()
converson_true_values = (1 - Ca_true_values / C_A_0) * 100

# Final Values
print(f&quot;Hybrid: \tQ: {Q_hybrid_values[-1]:.4f} \tC_A: {Ca_hybrid_values[-1]:.4f} \tC_B: {Cb_hybrid_values[-1]:.4f} \tT: {T_hybrid_values[-1]:.4f} \t Conversion: {converson_hybrid_values[-1]:.2f}%&quot;)
print(f&quot;True: \t\tQ: {Q_true_values[-1]:.4f} \tC_A: {Ca_true_values[-1]:.4f} \tC_B: {Cb_true_values[-1]:.4f} \tT: {T_true_values[-1]:.4f} \t Conversion: {converson_true_values[-1]:.2f}%&quot;)

# Comparison Graphs
plt.figure(figsize=(16, 16)),
plt.subplot(321)
plt.plot(np.arange(Ca_hybrid_values.shape[0]),Ca_hybrid_values, &#39;b&#39;)
plt.plot(np.arange(Ca_true_values.shape[0]),Ca_true_values, &#39;g&#39;)
plt.legend([&#39;C_A_hybrid_model&#39;,&#39;C_A_true&#39;])
plt.title(&#39;Concentration of A&#39;)

plt.subplot(322)
plt.plot(np.arange(Cb_hybrid_values.shape[0]),Cb_hybrid_values, &#39;b&#39;)
plt.plot(np.arange(Cb_true_values.shape[0]),Cb_true_values, &#39;g&#39;)
plt.legend([&#39;C_B_hybrid_model&#39;,&#39;C_B_true&#39;])
plt.title(&#39;Concentration of B&#39;)

plt.subplot(323)
plt.plot(np.arange(Q_hybrid_values.shape[0]),Q_hybrid_values, &#39;b&#39;)
plt.plot(np.arange(Q_true_values.shape[0]),Q_true_values, &#39;g&#39;)
plt.legend([&#39;Q_hybrid_model&#39;,&#39;Q_true&#39;])
plt.title(&#39;Heat duty input&#39;)

plt.subplot(324)
plt.plot(np.arange(T_hybrid_values.shape[0]),T_hybrid_values, &#39;b&#39;)
plt.plot(np.arange(T_true_values.shape[0]),T_true_values, &#39;g&#39;)
plt.legend([&#39;T_hybrid_model&#39;,&#39;T_true&#39;])
plt.title(&#39;Reactor Temperature&#39;)

plt.subplot(325)
plt.plot(np.arange(converson_hybrid_values.shape[0]),converson_hybrid_values, &#39;b&#39;)
plt.plot(np.arange(converson_true_values.shape[0]),converson_true_values, &#39;g&#39;)
plt.legend([&#39;Conversion_hybrid_model&#39;,&#39;Conversion_true&#39;])
plt.title(&#39;Conversion&#39;)

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hybrid:         Q: 62323.8266   C_A: 0.4913     C_B: 0.5087     T: 439.9377      Conversion: 50.87%
True:           Q: 59882.1817   C_A: 0.4912     C_B: 0.5088     T: 438.4732      Conversion: 50.88%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_CSTR_Example_16_1.png" src="../_images/examples_CSTR_Example_16_1.png" />
</div>
</div>
</section>
<section id="Acknowledgement">
<h2>Acknowledgement<a class="headerlink" href="#Acknowledgement" title="Permalink to this headline">¶</a></h2>
<p>This exaple was gently provided by <a class="reference external" href="http://ifatwww.et.uni-magdeburg.de/syst/about_us/people/kok/index.shtml">Rudolph Kok</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="learn_mpc.html" class="btn btn-neutral float-right" title="Learning an MPC controller with a NN" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="path_following_mpc.html" class="btn btn-neutral" title="Path following vs Trajectory Tracking MPC" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Johannes Pohlodek, Bruno Morabito.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script type="text/javascript" src="../None"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>